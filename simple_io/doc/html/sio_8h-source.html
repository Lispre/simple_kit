<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>sio.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>sio.h</h1><a href="sio_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/***************************************************************************</span>
00002 <span class="comment"> * </span>
00003 <span class="comment"> * Copyright (c) 2014 Baidu.com, Inc. All Rights Reserved</span>
00004 <span class="comment"> * $Id$ </span>
00005 <span class="comment"> * </span>
00006 <span class="comment"> **************************************************************************/</span>
00007  
00016 <span class="preprocessor">#ifndef __SIMPLE_IO_SIO_H</span>
00017 <span class="preprocessor"></span><span class="preprocessor">#define __SIMPLE_IO_SIO_H</span>
00018 <span class="preprocessor"></span>
00019 <span class="preprocessor">#include &lt;stdint.h&gt;</span>
00020 <span class="preprocessor">#include &lt;sys/epoll.h&gt;</span>
00021 <span class="preprocessor">#include "<a class="code" href="sio__timer_8h.html">sio_timer.h</a>"</span>
00022 
00023 <span class="preprocessor">#ifdef __cplusplus</span>
00024 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00025 <span class="preprocessor">#endif</span>
00026 <span class="preprocessor"></span>
00027 <span class="comment">/* fd触发的事件 */</span>
00028 <span class="keyword">enum</span> sio_event {
00029     SIO_READ,   <span class="comment">/* 可读 */</span>
00030     SIO_WRITE,   <span class="comment">/* 可写 */</span>
00031     SIO_ERROR,   <span class="comment">/* 错误 */</span>
00032 };
00033 
00034 <span class="keyword">struct </span>sio;
00035 <span class="keyword">struct </span>sio_fd;
00036 
00037 <span class="comment">/* 事件回调函数 */</span>
00038 <span class="keyword">typedef</span> void (*sio_callback_t)(<span class="keyword">struct </span>sio *sio, <span class="keyword">struct </span>sio_fd *sfd, <span class="keyword">enum</span> sio_event event, <span class="keywordtype">void</span> *arg);
00039 
00040 <span class="comment">/* 注册在sio的文件描述符 */</span>
00041 <span class="keyword">struct </span>sio_fd {
00042     <span class="keywordtype">int</span> fd;     <span class="comment">/* 用户监听的fd */</span>
00043     uint32_t watch_events;    <span class="comment">/* 用户监听的事件 */</span>
00044     sio_callback_t user_callback; <span class="comment">/* 用户的事件回调 */</span>
00045     <span class="keywordtype">void</span> *user_arg; <span class="comment">/* 用户参数 */</span>
00046     <span class="keywordtype">char</span> is_del; <span class="comment">/* 被sio_del移除 */</span>
00047 };
00048 
00049 <span class="comment">/* 文件描述符管理器 */</span>
00050 <span class="keyword">struct </span>sio {
00051     <span class="keywordtype">int</span> epfd; <span class="comment">/* epoll句柄 */</span>
00052     <span class="keyword">struct </span>epoll_event poll_events[64]; <span class="comment">/* epoll_wait的参数 */</span> 
00053     <span class="keywordtype">char</span> is_in_loop;    <span class="comment">/* 是否正在epoll_wait事件处理循环中 */</span>
00054     <span class="keywordtype">int</span> deferred_count; <span class="comment">/* 延迟待删除sio_fd个数 */</span>
00055     <span class="keywordtype">int</span> deferred_capacity; <span class="comment">/* 延迟待删除数组的大小 */</span>
00056     <span class="keyword">struct </span>sio_fd **deferred_to_close; <span class="comment">/* 延迟待删除sio_fd数组 */</span>
00057     <span class="keywordtype">int</span> wake_pipe[2];  <span class="comment">/* 唤醒sio_run的管道 */</span>
00058     <span class="keyword">struct </span>sio_fd *wake_sfd; <span class="comment">/* 注册在sio上的wake_pipe[0] */</span>
00059     <span class="keyword">struct </span>sio_timer_manager *st_mgr;         
00060 };
00061 
00071 <span class="keyword">struct </span>sio *<a class="code" href="sio_8c.html#a1">sio_new</a>();
00083 <span class="keywordtype">void</span> <a class="code" href="sio_8h.html#a5">sio_free</a>(<span class="keyword">struct</span> sio *sio);
00097 <span class="keyword">struct </span>sio_fd *<a class="code" href="sio_8h.html#a6">sio_add</a>(<span class="keyword">struct</span> sio *sio, <span class="keywordtype">int</span> fd, sio_callback_t callback, <span class="keywordtype">void</span> *arg);
00111 <span class="keywordtype">void</span> <a class="code" href="sio_8h.html#a7">sio_set</a>(<span class="keyword">struct</span> sio *sio, <span class="keyword">struct</span> sio_fd *sfd, sio_callback_t callback, <span class="keywordtype">void</span> *arg);
00123 <span class="keywordtype">void</span> <a class="code" href="sio_8h.html#a8">sio_del</a>(<span class="keyword">struct</span> sio *sio, <span class="keyword">struct</span> sio_fd *sfd);
00135 <span class="keywordtype">void</span> <a class="code" href="sio_8h.html#a9">sio_watch_write</a>(<span class="keyword">struct</span> sio *sio, <span class="keyword">struct</span> sio_fd *sfd);
00147 <span class="keywordtype">void</span> <a class="code" href="sio_8h.html#a10">sio_unwatch_write</a>(<span class="keyword">struct</span> sio *sio, <span class="keyword">struct</span> sio_fd *sfd);
00159 <span class="keywordtype">void</span> <a class="code" href="sio_8h.html#a11">sio_watch_read</a>(<span class="keyword">struct</span> sio *sio, <span class="keyword">struct</span> sio_fd *sfd);
00171 <span class="keywordtype">void</span> <a class="code" href="sio_8h.html#a12">sio_unwatch_read</a>(<span class="keyword">struct</span> sio *sio, <span class="keyword">struct</span> sio_fd *sfd);
00183 <span class="keywordtype">void</span> <a class="code" href="sio_8h.html#a13">sio_run</a>(<span class="keyword">struct</span> sio *sio, <span class="keywordtype">int</span> timeout_ms);
00194 <span class="keywordtype">void</span> <a class="code" href="sio_8h.html#a14">sio_wakeup</a>(<span class="keyword">struct</span> sio *sio);
00209 <span class="keywordtype">void</span> <a class="code" href="sio_8h.html#a15">sio_start_timer</a>(<span class="keyword">struct</span> sio *sio, <span class="keyword">struct</span> sio_timer *timer, uint64_t timeout_ms, sio_timer_callback_t callback, <span class="keywordtype">void</span> *arg);
00221 <span class="keywordtype">void</span> <a class="code" href="sio_8h.html#a16">sio_stop_timer</a>(<span class="keyword">struct</span> sio *sio, <span class="keyword">struct</span> sio_timer *timer);
00222 
00223 <span class="preprocessor">#ifdef __cplusplus</span>
00224 <span class="preprocessor"></span>}
00225 <span class="preprocessor">#endif</span>
00226 <span class="preprocessor"></span>
00227 <span class="preprocessor">#endif  //SIMPLE_IO_SIO_H</span>
00228 <span class="preprocessor"></span>
00229 <span class="comment">/* vim: set ts=4 sw=4 sts=4 tw=100 */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri May 30 19:19:48 2014 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
