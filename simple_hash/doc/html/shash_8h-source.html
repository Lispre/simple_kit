<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>shash.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>shash.h</h1><a href="shash_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/***************************************************************************</span>
00002 <span class="comment"> * </span>
00003 <span class="comment"> * Copyright (c) 2014 Baidu.com, Inc. All Rights Reserved</span>
00004 <span class="comment"> * $Id$ </span>
00005 <span class="comment"> * </span>
00006 <span class="comment"> **************************************************************************/</span>
00007  
00016 <span class="preprocessor">#ifndef SIMPLE_HASH_SHASH_H</span>
00017 <span class="preprocessor"></span><span class="preprocessor">#define SIMPLE_HASH_SHASH_H</span>
00018 <span class="preprocessor"></span>
00019 <span class="preprocessor">#include &lt;stdint.h&gt;</span>
00020 
00021 <span class="preprocessor">#ifdef __cplusplus</span>
00022 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00023 <span class="preprocessor">#endif</span>
00024 <span class="preprocessor"></span>
00025 <span class="comment">/* 初始化1 &lt;&lt; 9个buckets */</span>
00026 <span class="preprocessor">#define SHASH_INIT_NUM_BUCKETS 9</span>
00027 <span class="preprocessor"></span><span class="comment">/* 最多创建1 &lt;&lt; 63个buckets */</span>
00028 <span class="preprocessor">#define SHASH_MAX_NUM_BUCKETS 63</span>
00029 <span class="preprocessor"></span>
00030 <span class="keyword">struct </span>shash_node {
00031     <span class="keywordtype">char</span> *key;  <span class="comment">/* 哈希键, 内部分配内存 */</span>
00032     uint32_t key_len;   <span class="comment">/* 键的长度 */</span>
00033     <span class="keywordtype">void</span> *value;    <span class="comment">/* 用户数据 */</span>
00034     <span class="keyword">struct </span>shash_node *prev; <span class="comment">/* 哈希桶内的节点前驱 */</span>
00035     <span class="keyword">struct </span>shash_node *next; <span class="comment">/* 哈希桶内的节点后继 */</span>
00036 };
00037 
00038 <span class="keyword">struct </span>shash {
00039     uint64_t num_node; <span class="comment">/* 总节点个数 */</span>
00040     uint64_t num_buckets[2]; <span class="comment">/* bucket[0]和buckets[1]的桶数量指数(1 &lt;&lt; num_buckets[i]) */</span>
00041     <span class="keyword">struct </span>shash_node *buckets[2]; <span class="comment">/* buckets[0]是当前使用中的桶数组, buckets[1]是rehash中的桶数组 */</span>
00042     uint64_t rehash_bucket; <span class="comment">/* rehash 当前迁移到哪个buckets[0]的桶 */</span>
00043     uint32_t iterator_index;  <span class="comment">/* 正在迭代buckets[0]还是buckets[1], 只在iterator非空时有意义 */</span>
00044     uint64_t iterator_bucket; <span class="comment">/* 正在迭代当前buckets数组的第几个桶, 只在iterator非空时有意义 */</span>
00045     <span class="keyword">struct </span>shash_node *iterator; <span class="comment">/* 迭代器指向的节点, NULL表示迭代结束 */</span>
00046 };
00047 
00057 <span class="keyword">struct </span>shash *<a class="code" href="shash_8c.html#a0">shash_new</a>();
00068 <span class="keywordtype">void</span> <a class="code" href="shash_8h.html#a3">shash_free</a>(<span class="keyword">struct</span> shash *shash);
00082 <span class="keywordtype">int</span> <a class="code" href="shash_8h.html#a4">shash_insert</a>(<span class="keyword">struct</span> shash *shash, <span class="keyword">const</span> <span class="keywordtype">char</span> *key, uint32_t key_len, <span class="keywordtype">void</span> *value);
00095 <span class="keywordtype">int</span> <a class="code" href="shash_8h.html#a5">shash_erase</a>(<span class="keyword">struct</span> shash *shash, <span class="keyword">const</span> <span class="keywordtype">char</span> *key, uint32_t key_len);
00109 <span class="keywordtype">int</span> <a class="code" href="shash_8h.html#a6">shash_find</a>(<span class="keyword">struct</span> shash *shash, <span class="keyword">const</span> <span class="keywordtype">char</span> *key, uint32_t key_len, <span class="keywordtype">void</span> **value);
00120 <span class="keywordtype">void</span> <a class="code" href="shash_8h.html#a7">shash_begin_iterate</a>(<span class="keyword">struct</span> shash *shash);
00134 <span class="keywordtype">int</span> <a class="code" href="shash_8h.html#a8">shash_iterate</a>(<span class="keyword">struct</span> shash *shash, <span class="keyword">const</span> <span class="keywordtype">char</span> **key, uint32_t *key_len, <span class="keywordtype">void</span> **value);
00145 <span class="keywordtype">void</span> <a class="code" href="shash_8h.html#a9">shash_end_iterate</a>(<span class="keyword">struct</span> shash *shash);
00156 uint64_t <a class="code" href="shash_8h.html#a10">shash_size</a>(<span class="keyword">struct</span> shash *shash);
00157 
00158 <span class="preprocessor">#ifdef __cplusplus</span>
00159 <span class="preprocessor"></span>}
00160 <span class="preprocessor">#endif</span>
00161 <span class="preprocessor"></span>
00162 <span class="preprocessor">#endif  //SIMPLE_HASH_SHASH_H</span>
00163 <span class="preprocessor"></span>
00164 <span class="comment">/* vim: set ts=4 sw=4 sts=4 tw=100 */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jun 17 13:55:08 2014 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
